apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Chart.Name }}-paperless-postgresql-config
data:
  POSTGRES_DB: "paperless-ngx"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Chart.Name }}-paperless-config
data:
  # Admin user configuration
  PAPERLESS_ADMIN_USER: {{ .Values.paperless.admin.username | quote }}
  PAPERLESS_ADMIN_MAIL: {{ .Values.paperless.admin.email | quote }}
  PAPERLESS_ADMIN_PASSWORD: {{ .Values.paperless.admin.password | quote }}
  
  # Redis configuration (password will be injected via environment variable)
  PAPERLESS_REDIS: redis://{{ .Chart.Name }}-redis:6379

  # PostgreSQL configuration (password will be injected via environment variable)
  PAPERLESS_DBENGINE: postgresql
  PAPERLESS_DBHOST: {{ .Chart.Name }}-paperless-postgresql
  PAPERLESS_DBPORT: "5432"
  PAPERLESS_DBNAME: "paperless-ngx"

  # Gotenberg configuration      
  PAPERLESS_TIKA_ENABLED: "1"
  PAPERLESS_TIKA_GOTENBERG_ENDPOINT: http://{{ .Chart.Name }}-gotenberg:3000
  PAPERLESS_TIKA_ENDPOINT: http://{{ .Chart.Name }}-tika:9998

  PAPERLESS_ACCOUNT_ALLOW_SIGNUPS: {{ .Values.paperless.allowSignups | quote }}
  PAPERLESS_OCR_LANGUAGE: deu+eng
  PAPERLESS_DATE_PARSER_LANGUAGES: de+en
  PAPERLESS_OCR_OUTPUT_TYPE: pdfa-3
  PAPERLESS_CONSUMER_RECURSIVE: "true"
  PAPERLESS_CONSUMER_SUBDIRS_AS_TAGS: "true"
 
  PAPERLESS_URL: {{ printf "https://%s" .Values.paperless.ingress.host | quote }}
  PAPERLESS_CONSUMER_RECURSIVE: true
  PAPERLESS_CONSUMER_SUBDIRS_AS_TAGS: true
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Chart.Name }}-n8n-postgresql-config
data:
  POSTGRES_DB: "n8n"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Chart.Name }}-n8n-config
data:
  # N8N database configuration (password will be injected via environment variable)
  DB_TYPE: postgresdb
  DB_POSTGRESDB_HOST: {{ .Chart.Name }}-n8n-postgresql
  DB_POSTGRESDB_PORT: "5432"
  DB_POSTGRESDB_DATABASE: n8n
  N8N_SECURE_COOKIE: "false"
  N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS: "true"
  # N8N basic configuration
  N8N_HOST: {{ .Values.n8n.ingress.host | quote }}
  N8N_PORT: "5678"
  N8N_PROTOCOL: "http"
  N8N_LOG_LEVEL: "info"
  N8N_EDITOR_BASE_URL: {{ printf "http://%s" .Values.n8n.ingress.host | quote }}
  # Webhook configuration
  WEBHOOK_URL: {{ printf "http://%s" .Values.n8n.ingress.host | quote }}
  # Execution settings
  EXECUTIONS_PROCESS: "main"
  EXECUTIONS_DATA_SAVE_ON_ERROR: "all"
  EXECUTIONS_DATA_SAVE_ON_SUCCESS: "all"
  EXECUTIONS_DATA_SAVE_ON_PROGRESS: "false"
  # UI Configuration
  N8N_HIRING_BANNER_ENABLED: "false"
  N8N_PERSONALIZATION_ENABLED: "false"
  N8N_VERSION_NOTIFICATIONS_ENABLED: "false"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name:  {{ .Chart.Name }}-samba-config
data:
  USER: test;test
  SHARE: consume;/data/consume;yes;no;no;all;none;test;directory for consuming documents
  SHARE2: documents;/data/media/documents/originals;yes;yes;no;all;none;test;directory for document storage
  SHARE3: export;/data/export;yes;yes;no;all;none;test;directory for migrating exported documents
  GLOBAL: "log level = 3"
  GLOBAL1: "force user = root"
  GLOBAL2: "force group = root"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Chart.Name }}-paperless-init-scripts
data:
  # Dateiname wird zum Key. Der Inhalt ist der Dateiinhalt.
  10-create-consume-tags.sh: |
    #!bin/sh
    mkdir -p /usr/src/paperless/consume/{posteingangsrechnung,postausgangsrechnung}